<!DOCTYPE html>
<html lang="en">
<head>
    <%- include ("partials/head.ejs") %>
</head>
<body>
    <%- include ("partials/navbar.ejs") %>
    <%- include ("partials/header.ejs") %>
    <%- include ("partials/alert.ejs") %>
    <main>
        <div class="item-container">
            <div class="item-images">
                <div class="image-list">
                    <% if(item.images[0]){%>
                        <% item.images.forEach((e)=>{%>
                            <div class="mini-image">
                                <img id="img-<%= e.id %>" class="image-sidebar" src="data:image/jpg;base64,<%= e.image %>" onmouseenter="setPrincipal(<%= e.id %>)" alt="">
                            </div>
                        <% })%>
                    <% } %>
                </div>
                <div>
                    <% if(item.images[0]){%>
                        <img id="image-principal" src="data:image/jpg;base64,<%= image[0].image %>" alt="">
                    <% } %>
                </div>
            </div>
            <div class="item-info">
                <h1 class="item-name" id="name-info"><%= item.name %></h1>
                <div class="item-rate">
                    <div class="rate">
                        <% for(let i = 0; i < 5; i++){ %>
                            <% if(i+1 > item.mRate){ %>
                                <i class="fi fi-rr-star"></i>
                            <% }else{ %>
                                <i class="fi fi-sr-star"></i>
                            <% } %>
                        <% } %>
                    </div>
                    <div class="item-stock">
                        <% if(item.qtd != 0){ %>
                            <i class="fi fi-rr-check-circle instock"></i>
                            <p class="instock">em estoque</p>
                        <% }else{ %>
                            <i class="fi fi-rr-cross-circle outstock"></i>
                            <p class="outstock">sem estoque</p>
                        <% } %>
                    </div>
                </div>
                <div id="height-info" data-value= "<%= item.height %>"></div>
                <div id="width-info" data-value= "<%= item.width %>"></div>
                <div id="depth-info" data-value= "<%= item.depth %>"></div>
                <div id="weight-info" data-value= "<%= item.weight %>"></div>
                <div class="item-price">
                    <h1 id="price-info">R$ <%= item.price.toFixed(2) %></h1>
                    <p>6x R$ <%= ((item.price)/6).toFixed(2) %> sem juros</p>
                </div>
                <% if(item.qtd != 0){ %>
                    <button class="item-buy">COMPRE</button>
                    <button class="item-buy" onclick="addLittleCar()">+ CARRINHO</button>
                <% }else{ %>
                    <button class="item-buy" disabled>COMPRE</button>
                    <button class="item-buy" disabled>+ CARRINHO</button>
                <% } %>
            </div>
        </div>
        <div class="item-section">
            <div class="item-description">
                <p><%= item.description %></p>
            </div>
            <div class="item-rating">
                <div class="avg">
                    <p><%= item.mRate.toFixed(1) %></p>
                    <div class="rate">
                        <% for(let i = 0; i < 5; i++){ %>
                            <% if(i+1 > item.mRate){ %>
                                <i class="fi fi-rr-star"></i>
                            <% }else{ %>
                                <i class="fi fi-sr-star"></i>
                            <% } %>
                        <% } %>
                    </div>
                </div>
                <div class="appraisal-container">
                    <div class="appraisal-comment">
                        <% item.comments.forEach((data)=>{ %>
                            <div class="rate">
                                <% for(let i = 0; i < 5; i++){ %>
                                    <% if(i+1 > data.rate){ %>
                                        <i class="fi fi-rr-star"></i>
                                    <% }else{ %>
                                        <i class="fi fi-sr-star"></i>
                                    <% } %>
                                <% } %>
                            </div>
                                <p class="comment"><%= data.comment %></p>
                                <p class="comment-user">Por <%= data.name %></p>
                        <% }) %>
                    </div>
                    <div class="comment-form">
                        <% if(user){ %>
                            <form action="/comment/add/<%= item.id %>" method="post">
                                <textarea name="comment" id="comment" cols="30" rows="2"></textarea>
                                <input type="submit" value="Enviar">
                            </form>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script>
        // quando o mouse passar em cima de uma classe image-sidebar pegar a imagem e colocar na image-principal
        function setPrincipal(e){
            let img = document.getElementById(`img-${e}`);
            console.log(img);
            let imgPrincipal = document.getElementById("image-principal");
            imgPrincipal.src = img.src;
        }
    </script>
    <%- include ("partials/footer.ejs") %>
</body>
</html>